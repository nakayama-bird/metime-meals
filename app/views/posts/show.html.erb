<div class='container rounded-xl shadow-xl p-6 max-w-xs md:max-w-3xl mx-auto my-10 border border-white bg-base-100'>
    <div class='ml-6 mt-6'>
    <% if request.referer.present? %>
        <% referer_path = URI(request.referer).path %>
        <% if referer_path == maps_path %>
            <%= link_to '＜戻る', maps_path  %>
        <% elsif referer_path == mypage_posts_path %>
            <%= link_to '＜戻る', mypage_posts_path  %>
        <% else %>
            <%= link_to '＜戻る', posts_path  %>
        <% end %>
    <% else %>
        <%= link_to '＜戻る', posts_path  %>
    <% end %>
    </div>
    <div class='md:w-1/2 mx-auto'>
        <div class='text-center mt-6'>
            <h2 class='text-base mb-2 font-medium'>
                <%= @post.human_attribute_enum(:genre) %>
            </h2>
            <h1 class='text-2xl font-bold mb-6'>
                <%= @post.restaurant_name %>
            </h1>
        </div>
        <div class="flex justify-center flex-wrap">
            <%= render @post.tags %>
        </div>
        <p class='w-full mx-auto p-5'>
            おすすめポイント：
            <br><%= @post.body %></br>
        </p>
        <p class='w-full mx-auto p-5'>
            おひとり様おすすめ度：
        </p>
        <div class="flex justify-center flex-wrap">
        <svg class="w-6 h-6 ml-2 text-orange-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 22 20">
            <path d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"/>
        </svg>
            <%= @post.decorate.star_rating %>
        </div>
        <% if @post.amount %>
            <p class='w-full mx-auto p-5'>
                使用した金額：<%= @post.human_attribute_enum(:amount) %>
            </p>
        <% else %>
        <% end %>
        <div class="my-7">
            <div class="flex justify-center">
                <% if @post.post_images.present? %>
                <div class="carousel">
                    <div id="slide1" class="carousel-item relative w-full justify-center items-center">
                    <%= image_tag @post.post_images.first.to_s, width: 500 %>
                    <% if @post.post_images.second.present? %>
                        <div class="absolute flex justify-end transform -translate-y-1/2 right-2.5 top-1/2">
                        <a href="#slide2" class="btn btn-circle glass btn-sm">❯</a>
                        </div>
                    <% end %>
                    </div>
                    <% if @post.post_images.second.present? %>
                    <div id="slide2" class="carousel-item relative w-full justify-center items-center">
                        <%= image_tag @post.post_images.second.to_s, width: 500 %>
                        <div class="absolute flex justify-between transform -translate-y-1/2 left-2.5 right-2.5 top-1/2">
                        <a href="#slide1" class="btn btn-circle glass btn-sm">❮</a>
                        <% if @post.post_images.third.present? %>
                            <a href="#slide3" class="btn btn-circle glass btn-sm">❯</a>
                        <% end %>
                        </div>
                    </div>
                    <% end %>
                    <% if @post.post_images.third.present? %>
                    <div id="slide3" class="carousel-item relative w-full justify-center items-center">
                        <%= image_tag @post.post_images.third.to_s, width: 500 %>
                        <div class="absolute flex justify-start transform -translate-y-1/2 left-2.5 top-1/2">
                        <a href="#slide2" class="btn btn-circle glass btn-sm">❮</a>
                        </div>
                    </div>
                    <% end %>
                </div>
                <% end %>
            </div>
        </div>
    </div>
    <div class='md:w-1/2 mx-auto'>
        <p class='w-full mx-auto p-5'>
            所在地：
            <br><%= @post.address %></br>
        </p>
        <div id="map" class="w-full h-72"></div>
    </div>
    <%# ユーザー削除機能を実装したら分岐を設定 %>
    <div class='grid grid-cols-3 md:grid-cols-8 mt-10'>  
        <div class='col-start-1 flex items-center ml-5 md:col-start-2'><%= @post.user.name %></div>
            <% if logged_in? %>
                <% if current_user.own?(@post)%>
                    <div class='ml-6 md:col-start-6'><%= link_to '編集', edit_post_path(@post), class: "btn btn-primary" %></div>
                    <div class='ml-5 md:col-start-7'><%= link_to '削除', post_path(@post),data: {turbo_method: :delete, turbo_confirm: '投稿を削除しますか？'}, class: "btn btn-secondary" %></div>
                <% end %>
            <% end %>
        </div>
    </div>
</div>
<script>
    function initMap() {
    const mapElement = document.getElementById('map');

    const mapOptions = {
        center: { lat: <%= @post.latitude %>, lng: <%= @post.longitude %> },
        zoom: 16,
        disableDefaultUI: true,
    };

    const googleMapUrl = `
        <a href="https://www.google.com/maps/search/?api=1&query=<%= @post.latitude %>,<%= @post.longitude %>"
        class="font-medium text-blue-600 dark:text-blue-500 hover:underline">
        Googleマップで見る</a>`

    const infowindow = new google.maps.InfoWindow({
        content: googleMapUrl,
    });

    const map = new google.maps.Map(mapElement, mapOptions);

    const marker = new google.maps.Marker({
        position: { lat: <%= @post.latitude %>, lng: <%= @post.longitude %> },
        map: map,
    });

    marker.addListener("click", () => {
        infowindow.open({
        anchor: marker,
        map,
        });
    });
    }
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_API_KEY'] %>&callback=initMap"></script>